<!DOCTYPE html>
<html>

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link href="https://www.contentstack.com/sdks/contentstack-ui-extensions/dist/latest/ui-extension-sdk.css" rel="stylesheet" type="text/css" media="all">
  <style media="all">
.field-label{margin-top:10px;color:#4f6471;font-size:15px!important}.form-control{color:#748590;height:35px!important;max-width:255px!important}.container{padding-top:15px}.thumbnail{width:100%;height:100%}.select2-results__option{width:20%;float:left}img.img-thumbnail{max-height:126px}#run-btn{width:103px;margin-top:12px;margin-bottom:20px}#run-btn img{vertical-align:sub;margin-right:10px}#run-btn[disabled]{width:160px}.cs-form-group{margin-top:10px;margin-bottom:12px}label{font-weight:400;font-size:14px;color:#4f6470}.badge-info{background:#f0f9fe;border-radius:3px;font-size:14px;color:#6c7982;border:1px solid #c9dde2;white-space:normal}.count-value,.keys{font-size:14px;color:#748490}.keys{width:34%;margin-bottom:10px;display:inline-block}.list-group-item{background-color:#fff;border:none;padding-left:0}.result-li{border-bottom:1px solid rgba(0,0,0,.125)}#result-container{max-height:360px;padding-bottom:25px}body{max-height:600px;overflow:auto}.result-wrapper{border-bottom:2px solid rgba(0,0,0,.125)}#result-container::-webkit-scrollbar-track{border-radius:10px;background-color:transparent}#result-container::-webkit-scrollbar{width:5px;background-color:transparent}#result-container::-webkit-scrollbar-thumb{border-radius:6px;background-color:#dfe2e9;cursor:pointer}.alert-danger{display:block;font-size:12px;color:#f77d7a;text-align:left;padding-top:0;padding-left:0;margin-top:-10px;background-color:transparent;border:0}
</style>
  <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script src="https://assets.contentstack.io/v3/assets/bltc249966903dc3407/blt14fc510646d48b9e/5b8791325b3e6959793901e5/ui-extensions-sdk.js"></script>
</head>

<body>
  <form id="intelligence-form">
    <div class="container-fluid">
      <div class="cs-form-group">
        <label for="field" class="field-label">Field</label>
        <select class="form-control" id="field"></select>
      </div>
      <label class="model-label">Models</label>
      <div class="cs-checkbox row" id="features">
      </div>
      <button type="submit" id="run-btn" class="btn cs-btn-primary"><img src="https://images.contentstack.io/v3/assets/bltc249966903dc3407/blt40a60d26b3d8095f/5b7660b25b9f14da0eb07a34/operation.svg" alt="run-icon">Run</button>
    </div>  
  </form>
      <div class="container" id="result-container">
        <div id="nav-tabContent"></div>
      </div>
  <script>
"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function ConvertJsonToTable(parsedJson,tableId,tableClassName,linkText){var italic="<i>{0}</i>",link=linkText?'<a href="{0}">'+linkText+"</a>":'<a href="{0}">{0}</a>',idMarkup=tableId?' id="'+tableId+'"':"",classMarkup=tableClassName?' class="'+tableClassName+'"':"",tbl='<table border="1" cellpadding="1" cellspacing="1"'+idMarkup+classMarkup+">{0}{1}</table>",th="<thead>{0}</thead>",tb="<tbody>{0}</tbody>",tr="<tr>{0}</tr>",thRow="<th>{0}</th>",tdRow="<td>{0}</td>",thCon="",tbCon="",trCon="";if(parsedJson){var isStringArray="string"==typeof parsedJson[0],headers;if(isStringArray)thCon+=thRow.format("value");else if("object"==_typeof(parsedJson[0])){headers=array_keys(parsedJson[0]);for(var i=0;i<headers.length;i++)thCon+=thRow.format(headers[i])}if(th=th.format(tr.format(thCon)),isStringArray)for(var i=0;i<parsedJson.length;i++)tbCon+=tdRow.format(parsedJson[i]),trCon+=tr.format(tbCon),tbCon="";else if(headers)for(var urlRegExp=new RegExp(/(\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gi),javascriptRegExp=new RegExp(/(^javascript:[\s\S]*;$)/gi),i=0;i<parsedJson.length;i++){for(var j=0;j<headers.length;j++){var value=parsedJson[i][headers[j]],isUrl=urlRegExp.test(value)||javascriptRegExp.test(value);isUrl?tbCon+=tdRow.format(link.format(value)):value?"object"==(void 0===value?"undefined":_typeof(value))?tbCon+=tdRow.format(ConvertJsonToTable(eval(value.data),value.tableId,value.tableClassName,value.linkText)):tbCon+=tdRow.format(value):tbCon+=tdRow.format(italic.format(value).toUpperCase())}trCon+=tr.format(tbCon),tbCon=""}return tb=tb.format(trCon),tbl=tbl.format(th,tb),tbl}return null}function array_keys(e,t,n){var a=void 0!==t,r=[],o=!!n,i=!0,s="";if(e&&"object"===(void 0===e?"undefined":_typeof(e))&&e.change_key_case)return e.keys(t,n);for(s in e)e.hasOwnProperty(s)&&(i=!0,a&&(o&&e[s]!==t?i=!1:e[s]!=t&&(i=!1)),i&&(r[r.length]=s));return r}String.prototype.format=function(){var n=arguments;return this.replace(/{(\d+)}/g,function(e,t){return void 0!==n[t]?n[t]:"{"+t+"}"})};var toPercentage=function(e){return(100*e).toFixed(1)+"%"},combine=function(e){for(var t=e,n="",a=0;a<t.length-1;a+=1)n=n+t[a].text+", ";return n+t[t.length-1].text},features={categories:{name:"Categories",description:"Categorize your content into a 5-level taxonomy. The top three categories will be returned.",options:{},responseKeys:["score","label"],transform:function(e){return e.map(function(e){var t=e.score,n=e.label;return{score:toPercentage(t),label:n}})}},concepts:{name:"Concepts",description:'Recognize high-level concepts that are related to your text. For example, analysis of a research paper about deep learning would likely return the concept "Artificial Intelligence", even if that term is not explicitly mentioned in the paper.',options:{},responseKeys:["text","relevance","dbpedia_resource"],transform:function(e){return e.map(function(e){var t=e.text,n=e.relevance,a=e.dbpediaResource;return{text:t,relevance:toPercentage(n),dbpedia:a}})}},emotion:{name:"Emotion",description:"Detect emotion conveyed by the entire body of text.",options:{},responseKeys:["sadness","joy","fear","disgust","anger"],transform:function(e){var t=e.document;return Object.keys(t.emotion).map(function(e){return{emotion:e,score:toPercentage(t.emotion[e])}})}},entities:{name:"Entities",description:"Identify people, cities, organizations, and many other types of entities in your text.",options:{},responseKeys:["type","text","relevance","count"],transform:function(e){return e.map(function(e){var t=e.type,n=e.text,a=e.relevance,r=e.count;return{type:t,text:n,relevance:toPercentage(a),count:r}})}},keywords:{name:"Keywords",description:"Identify the important keywords in your content.",options:{},responseKeys:["text","relevance"],transform:function(e){return e.map(function(e){var t=e.text,n=e.relevance;return{text:t,relevance:toPercentage(n)}})}},relations:{name:"Relations",description:'Recognize when two entities are related, and identify the type of relation. For example, an "awardedTo" relation might connect the entities "Nobel Prize" and "Albert Einstein".',options:{},responseKeys:["type","sentence","score"],transform:function(e){return e.map(function(e){var t=e.arguments,n=e.score;return{type:e.type,args:combine(t),score:toPercentage(n)}})}},semantic_roles:{name:"Semantic Roles",description:"Parse sentences into subject, action, and object form.",options:{},responseKeys:["subject","object","action"],transform:function(e){return e.map(function(e){var t=e.action,n=e.object,a=e.subject;return{action:t.text,object:n.text,subject:a.text}})}},sentiment:{name:"Sentiment",description:"Analyze the general sentiment of your content or analyze the sentiment toward specific target phrases found in the text.",options:{},responseKeys:["text","score","label"],transform:function(e){var t=e.document;return[{score:toPercentage(t.score),label:t.label}]}}},fieldPaths=[];function getPaths(e,t){var o=[],d=void 0;return function c(e,t,n,a){var u=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[];d=a;var r=n?n.split("."):[];e.forEach(function(i){var s=[].concat(_toConsumableArray(r),[i.uid]),l=s.join(".");if(t&&void 0!==t[i.uid]){if("text"===i.data_type)if(!1===i.multiple){var e=d||l;o.push({uid:l,path:s,value:t[i.uid],setUid:e,titlePaths:[].concat(_toConsumableArray(u),[i.display_name])})}else 0<t[i.uid].length&&t[i.uid].forEach(function(e,t){var n=[].concat(_toConsumableArray(s),[t]),a=d||l;o.push({uid:n.join("."),path:n,value:e,setUid:a,titlePaths:[].concat(_toConsumableArray(u),[i.display_name,t])})});"group"===i.data_type&&(!1===i.multiple?c(i.schema,t[i.uid],l,d,[].concat(_toConsumableArray(u),[i.display_name])):0<t[i.uid].length&&t[i.uid].forEach(function(e,t){var n=[].concat(_toConsumableArray(s),[t]);c(i.schema,e,n.join("."),d,[].concat(_toConsumableArray(u),[i.display_name,t]))})),"blocks"===i.data_type&&0<t[i.uid].length&&t[i.uid].forEach(function(e,t){var n=[].concat(_toConsumableArray(s),[t]),a=Object.keys(e)[0],r=i.blocks.find(function(e){return e.uid===a}).schema,o=e[a];d=l,c(r,o,n.join("."),d,[].concat(_toConsumableArray(u),[i.display_name,t]))})}})}(e.schema,t),o}function runAnalysis(a,r,e){var o=e.url,i=e["x-api-key"],s=void 0;return new Promise(function(t,n){var e={"Content-Type":"application/json"};i&&(e["x-api-key"]=i),fetch(o,{method:"POST",body:JSON.stringify({text:r,features:a}),headers:e}).then(function(e){return s=e.status,e.json()}).then(function(e){if(200===s)return t(e);throw Error("Failed to run analysis:"+e.error)}).catch(function(e){n(e)})})}function activaTab(e){$(".tab-pane").hide(),$("#"+e).show("")}function renderFieldSelectField(e){var n=$("#field").val();$("#field").empty(),(fieldPaths=getPaths(e.entry.content_type,e.entry.getData())).forEach(function(e){var t=$("<option></option>").attr("value",e.uid).text(e.titlePaths.join(" > "));n===e.uid&&t.attr("selected","selected"),$("#field").append(t)})}function renderResult(a,e){$("#result-container").append('<label class="control-label col-sm-offset-2 col-sm-2" for="results" style="margin-left:-14px !important;">Results :</label><select id="results" style="margin-bottom:14px" class="form-control"></select><div id="nav-tabContent"></div>'),e.forEach(function(e,t){$("#results").append($('<option value="nav-'+e+'"></option>').text(features[e].name));var n=features[e].transform(a[e]);0===n.length&&(n=[{Message:"No results for "+e+" model"}]),$("#nav-tabContent").append($(' <div class="tab-pane" id="nav-'+e+'" style="display:'+(0===t?"block":"none")+';" role="tabpanel" aria-labelledby="nav-'+e+'-tab">'+ConvertJsonToTable(n,"jsonTable","table table-bordered table-hover","dbpedialink")+"</div>"))}),$("#results").on("change",function(){activaTab($("#results").val())})}function domChangeListner(a){a.entry.onSave(function(){return renderFieldSelectField(a)}),$("#run-btn").on("click",function(e){e.preventDefault(),$("#result-container").html("");var n={};$("#features input[type=checkbox]").each(function(e){var t=$("#features input[type=checkbox]")[e];t.checked&&(n[t.name]=features[t.name].options)});var t=Object.keys(n);return 0===t.length?$("#result-container").append('<div class="alert alert-danger" role="alert">Please select at least one analysis model</div>'):($("#run-btn").prop("disabled",!0),$("#run-btn").html("Working on it..."),runAnalysis(n,fieldPaths.find(function(e){return e.uid===$("#field").val()}).value,a.config).then(function(e){$("#run-btn").prop("disabled",!1),$("#run-btn").html(""),$("#run-btn").append('<img src="https://images.contentstack.io/v3/assets/bltc249966903dc3407/blt40a60d26b3d8095f/5b7660b25b9f14da0eb07a34/operation.svg" alt="run-icon"/> Run'),renderResult(e,t)}).catch(function(e){$("#run-btn").prop("disabled",!1),$("#run-btn").html(""),$("#run-btn").append('<img src="https://images.contentstack.io/v3/assets/bltc249966903dc3407/blt40a60d26b3d8095f/5b7660b25b9f14da0eb07a34/operation.svg" alt="run-icon"/> Run'),$("#result-container").append('<div class="alert alert-danger" role="alert">'+e.message+"</div>")}),!0)})}function renderModelSelectField(){$.each(features,function(e){$("#features").append($("<label></label>").attr("class","col-6").append($("<input></input>").attr("name",e).attr("type","checkbox").attr("class","cs")).append($("<span></span>").attr("class","lbl").text(features[e].name)))})}$(document).ready(function(){ContentstackUIExtension.init().then(function(e){e.window.enableAutoResizing(),renderModelSelectField(),renderFieldSelectField(e),domChangeListner(e)})});
</script>
</body>

</html>